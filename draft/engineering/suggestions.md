# KT.js 工程化建议（2026-02-10）

## 先回答你的问题：有道理吗？

有道理，而且是现在就值得做的事情。

你这个仓库已经具备明显的工程化基础（monorepo、多 package、自动构建、测试、lint、GitHub Actions），但目前这些能力还没有形成稳定闭环。  
换句话说：你已经有“零件”，现在需要把它们装成“流水线”。

---

## 现状快照（基于仓库实际检查）

1. **架构基础不错**：`packages/` 下有 `core/router/mui/shared/shortcuts/kt.js` 等模块，边界清晰。
2. **有测试资产**：仓库总计约 195 条测试用例，但默认入口 `pnpm test` 并不会跑完整测试集。
3. **测试闭环未打通**：`pnpm test2` 当前失败 16 条（`core` 的 fragment 相关和 `mui` 的 checkbox 相关）。
4. **类型检查未打通**：`pnpm check` 当前失败（大量 TS6305），说明检查配置和产物策略没有对齐。
5. **Lint 未收口**：`pnpm lint` 目前有 error，无法作为质量闸门。
6. **CI 目标单一**：`.github/workflows/deploy.yml` 主要做部署，缺少 PR 级别的 lint/typecheck/test 质量门。
7. **脚本一致性有缺口**：工作流里使用 `pnpm run build:example`，但根 `package.json` 里没有该脚本。

---

## 利弊分析

### 值得做的收益（Pros）

- **降低回归风险**：你是框架项目，核心行为（如 JSX/Fragment/reactive）一旦回归，影响面很大。
- **提升发布稳定性**：把“本地能跑”升级为“每次改动都可验证可发布”。
- **提高协作效率**：未来引入贡献者时，统一脚本和 CI 能显著减少沟通成本。
- **支持长期演进**：工程化不是为了“看起来规范”，而是为了支撑更快迭代且不崩盘。
- **增强外部信任**：对开源用户或团队采用者来说，工程化程度直接影响可用性判断。

### 需要承担的代价（Cons）

- **短期投入明显**：前 1-2 周会有“修管线”而不是“加功能”的感受。
- **流程约束变强**：提交前要过闸门，会牺牲一点开发随意性。
- **维护成本增加**：CI、脚本、规则不是一次性工作，需要持续维护。
- **学习/迁移成本**：团队成员要适应新的命令、分支策略和发布节奏。

---

## 建议路线图（按优先级）

### P0（本周）：先让质量闸门“可执行”

1. 统一根命令：明确 `lint`、`typecheck`、`test:all`、`build`、`ci` 的职责，避免“多个命令语义重叠”。
2. 修复脚本断点：补齐 `build:example` 或修改工作流命令，保证部署流程可复现。
3. 固化测试入口：让默认测试命令覆盖所有关键 package（不是只跑部分分组）。
4. 记录当前失败基线：把已知失败（16 tests、TS6305、lint errors）写进任务清单，避免“反复发现同一问题”。

### P1（1-2 周）：把红灯清到可发布状态

1. 优先修复 `core` 的 fragment 测试失败（这是框架核心行为）。
2. 修复 `mui` 的 checkbox 失败，避免示例和组件层出现行为偏差。
3. 解决 `pnpm check` 的 TS6305（一般是 tsconfig/composite/include 与输出策略不一致）。
4. 把 `pnpm lint` 收敛到 0 error（warning 可分阶段清理）。

### P2（第 3 周）：CI 真正成为质量门

1. 新增 PR 工作流：至少执行 `pnpm lint && pnpm check && pnpm test2 && pnpm build`。
2. 将部署工作流依赖质量门（或在部署前重复关键校验）。
3. 增加缓存（pnpm store）和并行策略，减少 CI 时间成本。

### P3（持续）：工程化从“能跑”到“可持续”

1. 引入变更集机制（如 changesets 或等效方案），规范多包版本发布。
2. 建立贡献文档：`CONTRIBUTING.md`、分支/提交约定、发布 checklist。
3. 增加关键能力基准测试（性能、包体积、兼容性），把“性能导向”变成可量化指标。

---

## 我给你的结论

你的判断是对的：**这个仓库已经到了必须工程化的阶段**。  
现在做，成本最低；再晚做，会在功能增长后以更高代价补课。

如果你愿意，我下一步可以直接帮你落地一个最小工程化改造 PR 方案（先改脚本和 CI，不动业务逻辑），让仓库在一轮内进入“可持续迭代”状态。
