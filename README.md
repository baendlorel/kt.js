# kt.js

[ä¸­æ–‡](./README.zh.md) | [English](./README.md)

For more awesome packages, check out [my homepageðŸ’›](https://baendlorel.github.io/?repoType=npm)

> Note: this library is under active development.

kt.js is a tiny, high-performance DOM utility focused on minimal re-rendering and direct DOM manipulation. It favors not forcing re-renders and aims to keep DOM updates to the absolute minimum for maximum performance.

Key philosophy

- No forced re-rendering. Changes are applied only when needed.
- Nearly zero unnecessary reflows/repaints.
- Minimal overhead and extremely small runtime cost.
- Direct DOM operations for predictable, fast updates.

## Getting started

Install via npm or your preferred package manager and import the functions you need from `src/index.ts`.

Primary exports (from `src/index.ts`)

- `h` â€” hyperscript helper
  - Creates a KText-enhanced DOM element representation.
  - Typical usage: h('div', { id: 'root' }, 'Hello') or using JSX-like helpers from the project.
  - Returns an `HTMLKEnhancedElement` (an HTMLElement with extra `enhance` properties described below).

- `css` â€” global CSS collector
  - Tagged template helper that collects provided CSS text into an internal list.
  - Usage: css`.foo { color: red; }`
  - The collected CSS is applied by `applyCss()` (invoked automatically by `createApp` if appropriate).

- `useScope` â€” scoped CSS helper
  - Provides a mechanism to scope CSS rules to a specific name/namespace. Works with the `css` helper and the library's scoped utilities.

- `createApp` â€” mount helper
  - Mounts a root `HTMLKEnhancedElement` to the document.
  - Signature: `createApp(rootElement: HTMLKEnhancedElement, mountTo?: HTMLElement)`
  - If `mountTo` is omitted, it tries `#app` and falls back to `document.body`.
  - Will call `applyCss()` to flush collected CSS to the document.

## Enhance-added properties and methods

After calling `enhance(element)` (done internally by `h` when appropriate), an HTMLElement becomes an `HTMLKEnhancedElement` with the following additions:

- Properties
  - `kid` (number): a per-element unique index generated by an internal `Indexer.nextKid()`.
  - `isKT` (true): boolean marker that identifies the element as a KText element.
  - `ktext` (string): getter/setter that proxies to an internal Text node stored on the element (reads/writes element text content).

- Methods
  - `kon(type, listener, options?)` â€” enhanced addEventListener
    - Normalizes options. Supports a `triggerLimit` option which will remove the listener after N triggers (if `triggerLimit === 1` it becomes `once`).
    - Returns the listener (or a wrapped listener used for limited triggers).
  - `koff(type, listener, options?)` â€” enhanced removeEventListener
    - Removes event listeners respecting provided options.
  - `kmount(element)` â€” append/mount helper
    - Equivalent to `element.appendChild(this)` and returns `this` for chaining.

## Examples

Create and mount an app:

```ts
import { h, css, createApp } from './src/index';

const root = h('div', { id: 'root' }, 'Hello world');
css`
  .root {
    color: hotpink;
  }
`;
createApp(root);
```

## Notes and caveats

- This library manipulates the DOM directly and intentionally keeps re-rendering minimal.
- `enhance` augments elements with non-enumerable descriptors for `ktext`, `isKT`, and `kid`, and assigns `kon`, `koff`, and `kmount` methods directly.
- The API is small and low-level by design â€” it's intended as a performance-focused building block rather than a full component framework.

## Contributing

PRs and issues are welcome. If you add features that affect the public API, update README and tests accordingly.

## License

See the repository `LICENSE` file.

# KT.js

For more awesome packages, check out [my homepageðŸ’›](https://baendlorel.github.io/?repoType=npm)

(image wait to be placed here)

## Philosophy: No Forced Repaint

KT.js is designed with a simple but radical philosophy: **never repaint unless absolutely necessary**. Unlike most frontend frameworks that rely on frequent DOM diffing and re-rendering, KT.js believes in minimal DOM operations and maximum stability.

- **Direct DOM Manipulation**: KT.js works with the DOM as it is, updating only what truly needs to change. No virtual DOM, no diffing, no hidden magic.
- **Predictable UI**: Your UI remains stable and predictable. If you don't explicitly change something, KT.js won't touch it.
- **Performance First**: By avoiding unnecessary redraws, KT.js achieves high performance, especially in complex or dynamic interfaces.
- **Developer Control**: You decide when and what to update. KT.js gives you the tools, not the rules.

> "Just don't repaint. Let the DOM be."

KT.js is for developers who want full control, minimal abstraction, and a framework that respects the browser's native strengths.

---

For API details and usage, see the documentation and examples in the `example/` folder.
