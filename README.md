# KT.js

[ä¸­æ–‡](./README.zh.md) | [English](./README.md)

For more awesome packages, check out [my homepageðŸ’›](https://baendlorel.github.io/?repoType=npm)

> Note: This framework is still under development. APIs, type declarations, and other parts may change. If you use it, please watch for updates in the near future.

KT.js is a tiny, high-performance DOM utility focused on minimal re-rendering and direct DOM manipulation. It favors not forcing re-renders and aims to keep DOM updates to the absolute minimum for maximum performance.

## Philosophy

As a web framework, repeatedly creating a large number of variables and objects is unacceptable. This is a provocation against browsers and the V8 engine(or SpiderMonkey, or JSC). So I created KT.js.

KT.js follows one rule: avoid repainting unless necessary. It updates the DOM directly and only where needed â€” no virtual DOM, no automatic diffing. That keeps the UI predictable and fast, while leaving control to the developer.

- **Direct DOM**: update only what changes.
- **Minimal updates**: avoid unnecessary reflows and repaints.
- **Predictable and fast**: stable UI with high performance.
- **Developer control**: you decide when to update.

## Getting started

Install via npm but pnpm is recommended:

```bash
npm install kt.js
# or
pnpm add kt.js
```

Import KT.js into your project.

```ts
import { h, createApp } from 'kt.js';

const app = h('div', { id: 'app' }, 'Hello, KT.js!');

createApp(app);
```

## Core Api

- `h` â€” hyperscript helper
  - Creates a KT-enhanced DOM element representation.
  - Typical usage:` h('div', { id: 'root' }, 'Hello')`.
  - Returns an `HTMLKEnhancedElement` (an HTMLElement with extra `enhance` properties described below).

- `createApp` â€” mount helper
  - Mounts a root `HTMLKEnhancedElement` to the document.
  - Signature: `createApp(rootElement: HTMLKEnhancedElement, mountTo?: HTMLElement)`
  - If `mountTo` is omitted, it tries `#app` and falls back to `document.body`.

## Enhance-added properties and methods

After calling `enhance(element)` (done internally by `h` when appropriate), an HTMLElement becomes an `HTMLKEnhancedElement` with the following additions:

- Properties
  - `kid` (number): a per-element unique index generated by an internal `Indexer.nextKid()`.
  - `isKT` (true): boolean marker that identifies the element as a KText element.
  - `ktext` (string): getter/setter that proxies to an internal Text node stored on the element (reads/writes element text content).
  - `kchildren` (array): getter/setter that exposes the element's children as an array of strings / enhanced elements. Setting `kchildren` replaces the element's content and accepts strings, Text nodes or other KT.js enhanced elements.

- Methods
  - `kon(type, listener, options?)` â€” enhanced addEventListener
    - Normalizes options. Supports a `triggerLimit` option which will remove the listener after N triggers (if `triggerLimit === 1` it becomes `once`).
    - Returns the listener (or a wrapped listener used for limited triggers).
  - `koff(type, listener, options?)` â€” enhanced removeEventListener
    - Removes event listeners respecting provided options.
  - `kmount(element)` â€” append/mount helper
    - Equivalent to `element.appendChild(this)` and returns `this` for chaining.

## Notes and caveats

- This library manipulates the DOM directly and intentionally keeps re-rendering minimal.
- `enhance` augments elements with non-enumerable descriptors for `ktext`, `isKT`, and `kid`, and assigns `kon`, `koff`, and `kmount` methods directly.
- The API is small and low-level by design â€” it's intended as a performance-focused building block rather than a full component framework.

## Contributing

PRs and issues are welcome. If you add features that affect the public API, update README and tests accordingly.

## License

MIT
